//FROM Library
$EXTERN FOpen, Putout, Close, Get;

$ENTRY Go {
  =
    // «Обрезаем» файл на случай, если он уже существует
    <Close <FOpen 'w' '__written_file.txt'>>

    <AppendLine ('__written_file.txt') 'Hello'>
    <AppendLine ('__written_file.txt') 'World'>
    <CheckContent <FOpen 'r' '__written_file.txt'> ('Hello') ('World') (0)>;
}

AppendLine {
  (e.FileName) e.Line =
    <
      {
        s.FileHandle =
          <Putout s.FileHandle e.Line>
          <Close s.FileHandle>;
      }
      <FOpen 'a' e.FileName>
    >;
}

CheckContent {
  s.FileHandle e.Lines =
    <
      {
        (e.NextLine 0) (e.NextLine 0) e.Lines^ =
          <Close s.FileHandle>;

        (e.NextLine) (e.NextLine) e.Lines^ =
          <CheckContent s.FileHandle e.Lines>;
      }
      (<Get s.FileHandle>) e.Lines
    >;
}
